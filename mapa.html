<!--Alison Julieth Diaz Espitia 
Cristian Daniel Feo Pararroyo 
Danna Alejandra Molina Beltr√°n 
Joan Daniel Vargas Avila -->

<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Explorando Bogot√° con Leaflet</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <style>
    body { background:#f8f9fa; }
    #map { height: 600px; min-height: 300px; width:100%; border: 1px solid #ddd; border-radius: 6px; }
    .controls { margin-bottom: 10px; }
    .card-title { font-size: 1.02rem; }
    @media (max-width:767px) { #map { height: 420px; } }
    .list-group-item { cursor: pointer; }
  </style>
</head>
<body>
  <div class="container py-4">
    <h1 class="mb-3">üåç Mapa interactivo con Leaflet</h1>
    <h5 class="mb-4 text-muted">Ejemplo de uso de la API de Leaflet + OpenStreetMap</h5>

    <div class="row g-3">
      <!-- MAPA -->
      <div class="col-md-8">
        <div class="controls d-flex align-items-center mb-2">
          <button id="btnBog" class="btn btn-primary btn-sm me-2">
            <i class="bi bi-geo"></i> Centrar Bogot√°
          </button>
          <button id="btnLocate" class="btn btn-outline-primary btn-sm me-2">
            <i class="bi bi-geo-alt"></i> Localizarme
          </button>
        </div>

        <div id="map"></div>

        <!-- Coordenadas -->
        <div class="card mt-3">
          <div class="card-body py-2">
            <h6 class="card-title mb-1">üìç Coordenadas actuales</h6>
            <p id="coordBadge" class="mb-0 text-secondary">Lat: ‚Äî , Lng: ‚Äî</p>
          </div>
        </div>
      </div>

      <!-- PANEL LATERAL -->
      <div class="col-md-4">
        <!-- Lugares tur√≠sticos -->
        <div class="card mb-3">
          <div class="card-header">üìå Lugares tur√≠sticos</div>
          <ul class="list-group list-group-flush" id="listaLugares">
            <li class="list-group-item lugar" data-lat="4.605" data-lng="-74.056">Monserrate</li>
            <li class="list-group-item lugar" data-lat="4.601" data-lng="-74.072">Museo del Oro</li>
            <li class="list-group-item lugar" data-lat="4.598" data-lng="-74.077">Plaza de Bol√≠var</li>
            <li class="list-group-item lugar" data-lat="4.658" data-lng="-74.094">Parque Sim√≥n Bol√≠var</li>
          </ul>
        </div>

        <!-- Acorde√≥n informativo -->
        <div class="accordion" id="accordionInfo">
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#whyLeaflet">
                ü§î ¬øPor qu√© Leaflet?
              </button>
            </h2>
            <div id="whyLeaflet" class="accordion-collapse collapse show" data-bs-parent="#accordionInfo">
              <div class="accordion-body">
                Ligero, f√°cil de aprender, open-source y con muchos plugins. Ideal para demos, trabajos y proyectos acad√©micos.
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#requirements">
                üõ†Ô∏è Requisitos b√°sicos
              </button>
            </h2>
            <div id="requirements" class="accordion-collapse collapse" data-bs-parent="#accordionInfo">
              <div class="accordion-body">
                Conocimientos b√°sicos de HTML y JavaScript. Un <code>&lt;div&gt;</code> con id para el mapa y CSS que le d√© altura.
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#features">
                ‚öôÔ∏è Funciones clave
              </button>
            </h2>
            <div id="features" class="accordion-collapse collapse" data-bs-parent="#accordionInfo">
              <div class="accordion-body">
                Inicializar mapa, capas de tiles, marcador, c√≠rculo, pol√≠gono, evento clic, geolocalizaci√≥n, rutas y control de capas.
              </div>
            </div>
          </div>

          <div class="accordion-item">
            <h2 class="accordion-header">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#notes">
                üìù Notas pr√°cticas
              </button>
            </h2>
            <div id="notes" class="accordion-collapse collapse" data-bs-parent="#accordionInfo">
              <div class="accordion-body">
                Geolocalizaci√≥n funciona solo en HTTPS o localhost. Recuerda atribuir OpenStreetMap si usas sus tiles.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // ====== Inicializaci√≥n del mapa ======
    const map = L.map('map').setView([4.711, -74.0721], 13);

    // Capas base
    const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap contributors', maxZoom: 19
    }).addTo(map);

    const topo = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenTopoMap'
    });

    const sat = L.tileLayer('https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
      subdomains:['mt0','mt1','mt2','mt3'],
      attribution: '¬© Google Maps'
    });

    // Control de capas
    L.control.layers({ "OSM": osm, "Topogr√°fico": topo, "Sat√©lite": sat }).addTo(map);

    // Marcador principal
    const marker = L.marker([4.711, -74.0721]).addTo(map).bindPopup('Bogot√°, D.C.');

    // Ruta de ejemplo
    const ruta = L.polyline([[4.598, -74.077], [4.605, -74.056]], { color: 'red' })
      .addTo(map).bindPopup("Ruta Plaza de Bol√≠var ‚Üí Monserrate");

    // ====== Lugares tur√≠sticos ======
    const lugares = {
      "Monserrate": [4.605, -74.056],
      "Museo del Oro": [4.601, -74.072],
      "Plaza de Bol√≠var": [4.598, -74.077],
      "Parque Sim√≥n Bol√≠var": [4.658, -74.094]
    };

    for (let nombre in lugares) {
      const coords = lugares[nombre];
      L.marker(coords).addTo(map).bindPopup(nombre).bindTooltip(nombre);
    }

    // Click en lista lateral
    document.querySelectorAll(".lugar").forEach(item => {
      item.addEventListener("click", () => {
        const lat = parseFloat(item.getAttribute("data-lat"));
        const lng = parseFloat(item.getAttribute("data-lng"));
        map.setView([lat, lng], 16);
      });
    });

    // ====== Eventos del mapa ======
    map.on('click', function(e){
      const lat = e.latlng.lat.toFixed(5);
      const lng = e.latlng.lng.toFixed(5);
      L.popup().setLatLng(e.latlng).setContent('Coordenadas: ' + lat + ', ' + lng).openOn(map);
      document.getElementById('coordBadge').textContent = 'Lat: ' + lat + ' , Lng: ' + lng;
    });

    document.getElementById('btnBog').addEventListener('click', function(){
      map.setView([4.711, -74.0721], 13);
    });

    // ====== Geolocalizaci√≥n ======
    document.getElementById('btnLocate').addEventListener('click', function(){
      map.locate({ setView: true, maxZoom: 16 });
    });

    let userMarker, userCircle;

    map.on('locationfound', function(e){
      if (userMarker) { map.removeLayer(userMarker); }
      if (userCircle) { map.removeLayer(userCircle); }

      userMarker = L.marker(e.latlng).addTo(map).bindPopup('Est√°s aqu√≠').openPopup();
      userCircle = L.circle(e.latlng, e.accuracy).addTo(map);

      document.getElementById('coordBadge').textContent = 
        'Lat: ' + e.latlng.lat.toFixed(5) + ' , Lng: ' + e.latlng.lng.toFixed(5);
    });

    map.on('locationerror', function(){
      alert('No fue posible obtener la ubicaci√≥n. Revisa permisos o usa HTTPS.');
    });

    // Escala
    L.control.scale({ metric: true, imperial: false }).addTo(map);
  </script>
</body>
</html>
